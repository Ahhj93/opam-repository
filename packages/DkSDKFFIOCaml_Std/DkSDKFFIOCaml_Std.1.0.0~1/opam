# Autogenerated by dksdk-ffi-ocaml's [package-DkSDKFFIOCaml_Std] target
# This file is generated by dune, edit dune-project instead
opam-version: "2.0"
synopsis: "DkSDK FFI for OCaml"
description: """
DkSDK FFI OCaml provides within-process communication from OCaml to another DkSDK FFI language (ex. DkSDK FFI Java).
This opam package downloads pre-built binaries for a limited set of platforms to avoid the C build tool differences between DkSDK and OCaml.
Full source code and other platforms are available with a DkSDK license from https://diskuv.com/pricing, and is free for security engineers, educators and related-field researchers on request."""
maintainer: ["Diskuv, Inc. <opensource+dkml@support.diskuv.com>"]
authors: ["Diskuv, Inc. <opensource+dkml@support.diskuv.com>"]
license: "OSL-3.0"
homepage: "https://diskuv.com/cmake/help/latest"
bug-reports:
  "https://gitlab.com/diskuv/distributions/1.0/dksdk-ffi-ocaml/-/issues"
depends: [
  "DkSDKFFIOCaml_StdExport-linux_x86_64" {arch = "x86_64" & os = "linux" & os-distribution != "alpine" & = "1.0.0"}
  "dune" {>= "3.8"}
  "capnp" {>= "3.5.0"}
  "dum" {>= "1.0.3"}
  "lwt"
  "uuidm" {>= "0.9.8"}
  "odoc" {with-doc}
]
build: [
  # Install foreign archive for the correct OS/architecture
  ["install" "%{DkSDKFFIOCaml_StdExport-linux_x86_64:lib}%/libDkSDKFFIOCaml_StdStatic.a"  "src/Std/libDkSDKFFIOCaml_StdExport.a"]  {arch = "x86_64" & os = "linux" & os-distribution != "alpine"}
  ["install" "%{DkSDKFFIOCaml_StdExport-linux_x86_64:lib}%/libDkSDKFFIOCaml_StdShared.so" "src/Std/dllDkSDKFFIOCaml_StdExport.so"] {arch = "x86_64" & os = "linux" & os-distribution != "alpine"}

  # Transform:
  #   (public_name DkSDKFFIOCaml_Std)
  # idempotently to:
  #   (public_name DkSDKFFIOCaml_Std) (foreign_archives DkSDKFFIOCaml_StdStatic)
  ["sh" "-eufcx"
    """
    sed 's/(public_name DkSDKFFIOCaml_Std)$/(public_name DkSDKFFIOCaml_Std) (foreign_archives DkSDKFFIOCaml_StdExport)/' src/Std/dune > src/Std/dune.tmp
    mv src/Std/dune.tmp src/Std/dune
    """
  ]

  ["dune" "subst"] {dev}
  [
    "dune"
    "build"
    "-p"
    name
    "-j"
    jobs
    "@install"
    "@runtest" {with-test}
    "@doc" {with-doc}
  ]
]
dev-repo:
  "git+https://gitlab.com/diskuv/distributions/1.0/dksdk-ffi-ocaml.git"
available: arch = "x86_64" & os = "linux" & os-distribution != "alpine"
url {
  src: "https://gitlab.com/api/v4/projects/45955665/packages/generic/stdexport/1.0.0-1/src-DkSDKFFIOCaml_Std.tar.gz"
  checksum: "sha512=a3f89199e314a3fb544f8bc1b682370b0664358d6489cccf33afbc4088c408d9e709817eb2c5504c091d20aac249d55d17f6d7ce339ef6791e6e5d9da2582c8d"
}
